<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Les Indispensables du Latin Juridique</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Merriweather:ital,wght@0,400;0,700;1,400&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .serif-font { font-family: 'Merriweather', serif; }
        
        /* Charte Graphique */
        .brand-blue-text { color: #0F2C48; }
        .brand-blue-bg { background-color: #0F2C48; }
        
        .brand-yellow-text { color: #D9A526; }
        .brand-yellow-bg { background-color: #D9A526; }
        .brand-yellow-border { border-color: #D9A526; }
        
        .brand-ivory-bg { background-color: #F6F2E8; }
        .brand-ivory-light { background-color: #fcfbf7; }
        
        .brand-bronze-text { color: #B4792A; }
        .brand-bronze-bg { background-color: #B4792A; }

        /* Navigation Active State */
        .nav-link.active {
            border-bottom: 3px solid #D9A526;
            color: #D9A526;
        }

        /* Flip Card Effects */
        .perspective { perspective: 1000px; }
        .card-inner {
            position: relative;
            width: 100%;
            height: 100%;
            text-align: center;
            transition: transform 0.6s;
            transform-style: preserve-3d;
        }
        .card-front, .card-back {
            position: absolute;
            width: 100%;
            height: 100%;
            -webkit-backface-visibility: hidden;
            backface-visibility: hidden;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            border-radius: 0.5rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }
        .card-back {
            transform: rotateY(180deg);
            overflow-y: auto; /* Allow scrolling for long content */
        }
        .flipped .card-inner {
            transform: rotateY(180deg);
        }

        /* Accordion Transition */
        .accordion-content {
            transition: max-height 0.3s ease-out;
            max-height: 0;
            overflow: hidden;
        }
        .accordion-content.open {
            max-height: 5000px; /* Arbitrary large number */
            transition: max-height 0.5s ease-in;
        }

        /* Scrollbar */
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
    </style>
</head>
<body class="bg-slate-50 text-slate-800 flex flex-col min-h-screen">

    <nav class="brand-blue-bg text-white shadow-lg sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4">
            <div class="flex flex-col md:flex-row justify-between items-center h-auto md:h-20 py-4 md:py-0">
                <div class="flex items-center gap-3 mb-4 md:mb-0">
                    <div class="w-10 h-10 rounded-full bg-[#D9A526] flex items-center justify-center text-[#0F2C48] font-bold text-xl">
                        <i class="fa-solid fa-scale-balanced"></i>
                    </div>
                    <div>
                        <h1 class="font-bold text-lg md:text-xl tracking-wide uppercase">Les Indispensables du Latin</h1>
                        <p class="text-xs text-[#D9A526] font-medium">Lexique Juridique & Social</p>
                    </div>
                </div>

                <div class="flex space-x-8 font-medium text-sm uppercase tracking-wider">
                    <button onclick="switchTab('lexique')" id="tab-lexique" class="nav-link active py-2 md:py-6 hover:text-[#D9A526] transition-colors flex items-center gap-2">
                        <i class="fa-solid fa-list"></i> Lexique A-Z
                    </button>
                    <button onclick="switchTab('game')" id="tab-game" class="nav-link py-2 md:py-6 hover:text-[#D9A526] transition-colors flex items-center gap-2">
                        <i class="fa-solid fa-graduation-cap"></i> Jeu / Entraînement
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <main class="flex-grow w-full max-w-7xl mx-auto p-4 md:p-8 relative">

        <div id="view-lexique" class="transition-opacity duration-300">
            
            <div class="brand-ivory-bg p-6 rounded-lg shadow-sm border-l-4 border-[#D9A526] mb-8">
                <div class="flex flex-col md:flex-row gap-4 items-center">
                    <div class="relative w-full md:w-2/3">
                        <i class="fa-solid fa-magnifying-glass absolute left-4 top-1/2 transform -translate-y-1/2 brand-blue-text"></i>
                        <input type="text" id="searchInput" placeholder="Rechercher un mot latin, une définition..." 
                               class="w-full pl-10 pr-4 py-3 bg-white border border-slate-300 rounded focus:ring-2 focus:ring-[#D9A526] focus:border-[#D9A526] outline-none shadow-sm transition-all">
                    </div>
                    <div class="w-full md:w-1/3 text-right">
                        <span class="text-sm font-bold brand-blue-text"><span id="total-terms">0</span> locutions référencées</span>
                    </div>
                </div>
            </div>

            <div class="sticky top-20 z-40 bg-white/95 backdrop-blur-sm border-b border-slate-200 py-3 mb-6 overflow-x-auto whitespace-nowrap shadow-sm">
                <div class="flex gap-2 px-2" id="alphabet-nav">
                    <!-- Letters injected by JS -->
                </div>
            </div>

            <div id="lexicon-container" class="space-y-4">
                <!-- Sections A, B, C... injected by JS -->
            </div>
            
            <div id="noResults" class="hidden text-center py-12">
                <i class="fa-solid fa-ghost text-4xl text-slate-300 mb-3"></i>
                <p class="text-slate-500">Aucune locution trouvée.</p>
            </div>
        </div>

        <div id="view-game" class="hidden transition-opacity duration-300 flex flex-col items-center justify-center min-h-[60vh]">
            
            <div class="text-center mb-8">
                <h2 class="text-2xl font-bold brand-blue-text mb-2">Mode Entraînement</h2>
                <p class="text-slate-500 max-w-md mx-auto">Testez vos connaissances ! Regardez le terme, essayez de deviner la définition, puis cliquez pour retourner la carte.</p>
            </div>

            <div class="perspective w-full max-w-lg h-[400px] cursor-pointer group" onclick="flipCard()">
                <div class="card-inner transition-transform duration-700 relative w-full h-full" id="game-card-inner">
                    
                    <div class="card-front brand-blue-bg text-white border-4 border-[#D9A526] p-8">
                        <div class="absolute top-4 right-4 text-[#D9A526] text-4xl opacity-20">
                            <i class="fa-solid fa-question"></i>
                        </div>
                        <p class="text-[#D9A526] text-sm uppercase tracking-widest font-bold mb-6">Locution Latine</p>
                        <h3 id="card-term" class="text-4xl font-bold serif-font text-center">...</h3>
                        <p class="mt-8 text-sm text-slate-300 italic animate-pulse">Cliquez pour révéler</p>
                    </div>

                    <div class="card-back bg-white border border-slate-200 shadow-xl p-8">
                         <div class="absolute top-4 right-4 brand-bronze-text text-4xl opacity-20">
                            <i class="fa-solid fa-lightbulb"></i>
                        </div>
                        <h3 id="card-term-back" class="text-xl font-bold brand-blue-text serif-font mb-2">...</h3>
                        <p id="card-trans" class="text-[#D9A526] italic font-medium mb-4 pb-2 border-b border-slate-100">...</p>
                        
                        <div class="text-left w-full space-y-4 overflow-y-auto max-h-[250px] pr-2 custom-scroll">
                            <div>
                                <span class="text-xs font-bold text-slate-400 uppercase">Définition</span>
                                <p id="card-def" class="text-slate-700 text-sm leading-relaxed">...</p>
                            </div>
                            <div class="brand-ivory-bg p-3 rounded border-l-4 border-[#B4792A]">
                                <span class="text-xs font-bold brand-bronze-text uppercase block mb-1">Contexte / Exemple</span>
                                <p id="card-ex" class="text-slate-600 text-sm italic">...</p>
                            </div>
                        </div>
                    </div>

                </div>
            </div>

            <div class="mt-8 flex gap-4">
                <button onclick="nextCard()" class="px-8 py-3 bg-[#D9A526] hover:bg-[#b4881d] text-white font-bold rounded-full shadow-lg transition-transform hover:scale-105 active:scale-95 flex items-center gap-2">
                    Locution Suivante <i class="fa-solid fa-arrow-right"></i>
                </button>
            </div>

        </div>

    </main>

    <button onclick="scrollToTop()" id="backToTop" class="fixed bottom-8 right-8 w-12 h-12 bg-[#0F2C48] text-white rounded-full shadow-lg flex items-center justify-center hover:bg-[#D9A526] transition-colors z-50 opacity-0 pointer-events-none duration-300">
        <i class="fa-solid fa-arrow-up"></i>
    </button>

    <footer class="brand-blue-bg text-white mt-auto">
        <div class="max-w-7xl mx-auto px-4 py-8">
            <div class="flex flex-col md:flex-row justify-between items-center gap-6 text-center md:text-left">
                
                <div>
                    <h3 class="text-[#D9A526] font-bold text-lg mb-1">Créé par Mathilde Martine PAISLEY</h3>
                    <p class="text-slate-400 text-xs">Document pédagogique à usage interne</p>
                </div>

                <div class="flex gap-4">
                    <a href="#" class="text-slate-300 hover:text-white transition-colors text-sm">Mentions Légales</a>
                    <span class="text-slate-600">|</span>
                    <a href="#" class="text-slate-300 hover:text-white transition-colors text-sm">Contact</a>
                </div>

                <div class="text-slate-400 text-sm">
                    &copy; 2025 - Tous droits réservés
                </div>
            </div>
        </div>
    </footer>

    <script>
        // DATA
        const lexiconData = [
            { term: "A contrario", trans: "Par le contraire", def: "Argumentation déduisant d'une situation non prévue l'application de la règle inverse.", ex: "La loi prévoit X pour les CDI. A contrario, pour les CDD, c'est la règle Y qui s'applique." },
            { term: "A fortiori", trans: "À plus forte raison", def: "Argumentation qui étend une règle à un cas non prévu, car les raisons sont encore plus évidentes.", ex: "Si la faute simple justifie une sanction, a fortiori la faute grave justifie un licenciement." },
            { term: "Ab absurdo", trans: "Par l'absurde", def: "Démontrer la fausseté d'une proposition en montrant que sa conséquence est absurde.", ex: "Le raisonnement aboutirait à ce que l'employeur paie le salarié qui n'a jamais travaillé : absurde." },
            { term: "Ab initio", trans: "Dès le commencement", def: "Se dit d'un acte qui prend effet depuis son origine.", ex: "Si une condition essentielle manque, le contrat est nul ab initio." },
            { term: "Ab irato", trans: "Sous le coup de la colère", def: "Qualification d'un acte accompli sous l'emportement.", ex: "Une sanction prononcée ab irato risque d'être annulée." },
            { term: "Abusus non tollit usum", trans: "L'abus n'empêche pas l'usage", def: "Le fait qu'un droit soit abusé ne signifie pas qu'il n'existe pas.", ex: "L'abus des périodes d'essai par certains ne supprime pas le droit d'en insérer une." },
            { term: "Accessorium sequitur principale", trans: "L'accessoire suit le principal", def: "Le sort de l'accessoire est lié à celui de l'élément principal.", ex: "L'annulation du contrat (principal) entraîne l'annulation de la clause de non-concurrence." },
            { term: "Actio personalis moritur cum persona", trans: "L'action meurt avec la personne", def: "L'action en justice s'éteint avec le décès.", ex: "Le décès du salarié met fin au contrat et aux actions personnelles." },
            { term: "Actori incumbit probatio", trans: "La preuve incombe au demandeur", def: "C'est à celui qui allègue un fait de le prouver.", ex: "Le salarié qui réclame des heures supplémentaires doit les prouver." },
            { term: "Actor sequitur forum rei", trans: "Le demandeur suit le tribunal du défendeur", def: "Le litige est porté devant le tribunal du défendeur.", ex: "Principe de compétence territoriale." },
            { term: "Actus reus / Mens rea", trans: "Acte coupable / Esprit coupable", def: "Éléments constitutifs de l'infraction (matériel et moral).", ex: "Pour le vol : prendre (actus) avec l'intention de voler (mens)." },
            { term: "Ad cautelam", trans: "Par précaution", def: "Par mesure de prudence.", ex: "Courrier de contestation envoyé ad cautelam." },
            { term: "Ad hoc", trans: "À cet effet précis", def: "Spécialement désigné pour une fonction.", ex: "Administrateur ad hoc pour une succession délicate." },
            { term: "Ad impossibilia nemo tenetur", trans: "À l'impossible nul n'est tenu", def: "On ne peut être contraint à une obligation impossible.", ex: "Cas de force majeure rendant le travail impossible." },
            { term: "Ad litem", trans: "Pour le procès", def: "Relatif à l'instance en cours.", ex: "Mandataire ad litem désigné pour la procédure." },
            { term: "Ad nutum", trans: "Au gré de", def: "Révoqué sans motif exigé.", ex: "Révocation ad nutum du président de SAS." },
            { term: "Ad probationem", trans: "À titre de preuve", def: "Condition de forme pour prouver l'acte.", ex: "L'écrit est souvent requis ad probationem." },
            { term: "Ad validitatem", trans: "À titre de validité", def: "Condition de forme pour la validité de l'acte.", ex: "Certains contrats solennels exigent un écrit ad validitatem." },
            { term: "Affectio societatis", trans: "Volonté de s'associer", def: "Volonté de collaborer à l'œuvre commune.", ex: "Élément essentiel du contrat de société." },
            { term: "Aliud est celare, aliud tacere", trans: "Cacher est une chose, se taire une autre", def: "Distinction entre réticence dolosive et simple silence.", ex: "Dissimulation active vs omission." },
            { term: "Amicus curiæ", trans: "Ami de la Cour", def: "Tiers présentant un avis éclairé au tribunal.", ex: "Une association dépose un mémoire amicus curiæ." },
            { term: "Argumentum a silentio", trans: "Argument du silence", def: "Conclure du silence d'un texte.", ex: "La loi ne l'interdit pas, donc c'est permis." },
            { term: "Audi alteram partem", trans: "Que l'autre partie soit entendue", def: "Principe du contradictoire.", ex: "Entretien préalable au licenciement." },
            { term: "Bona fide", trans: "De bonne foi", def: "Honnêteté, loyauté.", ex: "Exécution du contrat de bonne foi." },
            { term: "Bonus dolus", trans: "Le bon dol", def: "Petite exagération tolérée.", ex: "Embellir légèrement un CV (sans fausse déclaration)." },
            { term: "Casus belli", trans: "Cas de guerre", def: "Fait justifiant une hostilité majeure.", ex: "Faute lourde justifiant rupture immédiate." },
            { term: "Caveat emptor", trans: "Que l'acheteur soit vigilant", def: "L'acheteur doit s'informer.", ex: "Vigilance dans les relations commerciales." },
            { term: "Cogito ergo sum", trans: "Je pense donc je suis", def: "Principe philosophique d'existence.", ex: "Capacité juridique de la personne physique." },
            { term: "Contra legem", trans: "Contre la loi", def: "Acte violant la règle légale.", ex: "Clause inférieure au SMIC." },
            { term: "Corpus delicti", trans: "Corps du délit", def: "Élément matériel de l'infraction.", ex: "L'objet volé." },
            { term: "Cui bono ?", trans: "À qui profite le crime ?", def: "Recherche du mobile.", ex: "Enquête interne." },
            { term: "Culpa lata", trans: "Faute lourde", def: "Faute d'une extrême gravité.", ex: "Intention de nuire." },
            { term: "Culpa levis", trans: "Faute légère", def: "Simple négligence.", ex: "Erreur involontaire." },
            { term: "Curia novit iura", trans: "La Cour connaît le droit", def: "Le juge applique la règle de droit adéquate.", ex: "Requalification juridique par le juge." },
            { term: "Damnum emergens", trans: "Dommage émergent", def: "Perte subie immédiatement.", ex: "Perte de salaire." },
            { term: "De facto", trans: "De fait", def: "Situation réelle.", ex: "Gérant de fait." },
            { term: "De jure", trans: "De droit", def: "Situation légale.", ex: "Gérant de droit." },
            { term: "Dura lex, sed lex", trans: "La loi est dure, mais c'est la loi", def: "Application stricte de la loi.", ex: "Rigueur des délais de prescription." },
            { term: "Erga omnes", trans: "À l'égard de tous", def: "Opposable à tout le monde.", ex: "Publication au greffe." },
            { term: "Exceptio non adimpleti contractus", trans: "Exception d'inexécution", def: "Suspension si l'autre ne paie pas/n'exécute pas.", ex: "Droit de retrait." },
            { term: "Ex nunc", trans: "Pour l'avenir", def: "Pas d'effet rétroactif.", ex: "Résiliation." },
            { term: "Ex tunc", trans: "Depuis l'origine", def: "Effet rétroactif.", ex: "Nullité du contrat." },
            { term: "In abstracto", trans: "Dans l'abstrait", def: "Par rapport à un standard moyen.", ex: "Le bon père de famille." },
            { term: "In concreto", trans: "Dans le concret", def: "Selon les circonstances réelles.", ex: "Appréciation de la faute." },
            { term: "In limine litis", trans: "Au seuil du procès", def: "Avant tout débat au fond.", ex: "Exception de procédure." },
            { term: "In solidum", trans: "Solidairement", def: "Tenus ensemble de la dette.", ex: "Condamnation solidaire." },
            { term: "Intuitu personæ", trans: "En considération de la personne", def: "La personne est déterminante.", ex: "Contrat de travail." },
            { term: "Ipso facto", trans: "Par le fait même", def: "Automatiquement.", ex: "Fin du CDD à l'échéance." },
            { term: "Lucrum cessans", trans: "Gain manqué", def: "Manque à gagner.", ex: "Perte de commissions futures." },
            { term: "Mala fides", trans: "Mauvaise foi", def: "Intention malhonnête.", ex: "Sabotage." },
            { term: "Mutatis mutandis", trans: "En changeant ce qui doit l'être", def: "Adaptation à un contexte différent.", ex: "Application par analogie." },
            { term: "Mutuus dissensus", trans: "Consentement mutuel à rompre", def: "Accord pour rompre.", ex: "Rupture conventionnelle." },
            { term: "Ne bis in idem", trans: "Pas deux fois pour la même chose", def: "Interdiction de double sanction.", ex: "Avertissement puis licenciement pour les mêmes faits : interdit." },
            { term: "Nemo auditur...", trans: "Nul ne peut se prévaloir de sa turpitude", def: "On ne réclame pas justice d'une situation illégale qu'on a créée.", ex: "Fraudeur réclamant des indemnités." },
            { term: "Nemo censetur ignorare legem", trans: "Nul n'est censé ignorer la loi", def: "L'ignorance n'est pas une excuse.", ex: "L'employeur doit connaître le Code du travail." },
            { term: "Nullum crimen sine lege", trans: "Pas de crime sans loi", def: "Légalité des délits et peines.", ex: "Sanction prévue au règlement intérieur." },
            { term: "Pacta sunt servanda", trans: "Les contrats doivent être respectés", def: "Force obligatoire du contrat.", ex: "Le contrat est la loi des parties." },
            { term: "Prima facie", trans: "À première vue", def: "Apparence de vérité.", ex: "Preuve apparente." },
            { term: "Pro rata temporis", trans: "Proportionnel au temps", def: "Calcul selon la durée.", ex: "Calcul des congés payés." },
            { term: "Quantum", trans: "Montant", def: "La somme due.", ex: "Quantum des dommages-intérêts." },
            { term: "Quid pro quo", trans: "Donnant donnant", def: "Contrepartie.", ex: "Salaire contre travail." },
            { term: "Ratio decidendi", trans: "Raison de la décision", def: "Motif juridique déterminant.", ex: "Fondement de la jurisprudence." },
            { term: "Res judicata", trans: "Chose jugée", def: "Définitif.", ex: "Autorité de la chose jugée." },
            { term: "Statu quo", trans: "État actuel", def: "Maintien de la situation.", ex: "Geler les positions." },
            { term: "Sub judice", trans: "En cours de jugement", def: "Affaire non tranchée.", ex: "Devant le tribunal." },
            { term: "Sui generis", trans: "De son propre genre", def: "Spécifique, unique.", ex: "Contrat atypique." },
            { term: "Ultra petita", trans: "Au-delà de la demande", def: "Statuer sur ce qui n'est pas demandé.", ex: "Interdiction pour le juge." },
            { term: "Vacatio legis", trans: "Vacance de la loi", def: "Délai avant application.", ex: "Entrée en vigueur différée." }
        ];

        // Ensure data is sorted alphabetically
        lexiconData.sort((a, b) => a.term.localeCompare(b.term));

        // UTILS
        const $ = (id) => document.getElementById(id);
        
        // DOM Elements References
        let totalTermsEl, container, alphabetNav, searchInput, noResults, backToTopBtn;
        
        // --- VIEW 1: LEXICON LOGIC ---

        function initLexicon() {
            totalTermsEl.textContent = lexiconData.length;
            // Removed erroneous reference to totalCountEl

            // Group by Letter
            const grouped = {};
            lexiconData.forEach(item => {
                const letter = item.term.charAt(0).toUpperCase();
                if (!grouped[letter]) grouped[letter] = [];
                grouped[letter].push(item);
            });

            // 1. Generate Alphabet Nav
            const letters = Object.keys(grouped).sort();
            letters.forEach(letter => {
                const btn = document.createElement('button');
                btn.className = 'px-3 py-1 text-sm font-bold text-slate-500 hover:text-[#D9A526] hover:bg-slate-50 rounded transition-colors';
                btn.textContent = letter;
                btn.onclick = () => scrollToLetter(letter);
                alphabetNav.appendChild(btn);
            });

            // 2. Generate Accordions
            container.innerHTML = '';
            letters.forEach(letter => {
                const section = document.createElement('div');
                section.id = `section-${letter}`;
                section.className = 'border border-slate-200 rounded-lg overflow-hidden bg-white shadow-sm';

                // Header
                const header = document.createElement('button');
                header.className = 'w-full flex justify-between items-center p-4 brand-ivory-bg hover:bg-[#eae6db] transition-colors text-left';
                header.onclick = () => toggleAccordion(letter);
                header.innerHTML = `
                    <div class="flex items-center gap-3">
                        <span class="w-8 h-8 rounded-full brand-blue-bg text-white flex items-center justify-center font-bold">${letter}</span>
                        <span class="font-bold brand-blue-text text-lg">${grouped[letter].length} locutions</span>
                    </div>
                    <i id="icon-${letter}" class="fa-solid fa-chevron-down text-slate-400 transition-transform duration-300"></i>
                `;

                // Content
                const contentWrapper = document.createElement('div');
                contentWrapper.id = `content-${letter}`;
                contentWrapper.className = 'accordion-content';
                
                const grid = document.createElement('div');
                grid.className = 'p-4 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 bg-white';
                
                grouped[letter].forEach(item => {
                    const card = document.createElement('div');
                    card.className = 'p-4 border border-slate-100 rounded hover:shadow-md transition-shadow bg-white flex flex-col h-full search-item';
                    card.innerHTML = `
                        <h3 class="font-bold brand-blue-text text-lg mb-1 serif-font">${item.term}</h3>
                        <p class="text-[#B4792A] italic text-sm mb-3 border-b border-slate-100 pb-2">${item.trans}</p>
                        <p class="text-slate-600 text-sm mb-3 flex-grow">${item.def}</p>
                        <div class="bg-slate-50 p-2 rounded text-xs border-l-2 border-[#D9A526]">
                            <span class="font-bold text-[#0F2C48]">Exemple :</span> <span class="text-slate-500 italic">${item.ex}</span>
                        </div>
                    `;
                    grid.appendChild(card);
                });

                contentWrapper.appendChild(grid);
                section.appendChild(header);
                section.appendChild(contentWrapper);
                container.appendChild(section);
            });
        }

        function toggleAccordion(letter) {
            const content = $(`content-${letter}`);
            const icon = $(`icon-${letter}`);
            
            const isOpen = content.classList.contains('open');
            
            if (isOpen) {
                content.classList.remove('open');
                icon.style.transform = 'rotate(0deg)';
            } else {
                content.classList.add('open');
                icon.style.transform = 'rotate(180deg)';
            }
        }

        function scrollToLetter(letter) {
            const el = $(`section-${letter}`);
            // Open it first
            const content = $(`content-${letter}`);
            if (!content.classList.contains('open')) toggleAccordion(letter);
            
            // Scroll
            const offset = 180; // Adjust for navbar + sticky alpha nav
            const bodyRect = document.body.getBoundingClientRect().top;
            const elementRect = el.getBoundingClientRect().top;
            const elementPosition = elementRect - bodyRect;
            const offsetPosition = elementPosition - offset;

            window.scrollTo({
                top: offsetPosition,
                behavior: 'smooth'
            });
        }

        // --- VIEW 2: GAME LOGIC ---
        let currentCardIndex = -1;

        function pickRandomCard() {
            // Unflip first
            const cardInner = $('game-card-inner');
            const wasFlipped = cardInner.parentElement.classList.contains('flipped');
            
            if (wasFlipped) {
                cardInner.parentElement.classList.remove('flipped');
                setTimeout(() => setNewCardContent(), 300); // Wait for half flip
            } else {
                setNewCardContent();
            }
        }

        function setNewCardContent() {
            let newIndex;
            do {
                newIndex = Math.floor(Math.random() * lexiconData.length);
            } while (newIndex === currentCardIndex);
            
            currentCardIndex = newIndex;
            const item = lexiconData[currentCardIndex];

            $('card-term').textContent = item.term;
            
            // Back
            $('card-term-back').textContent = item.term;
            $('card-trans').textContent = `"${item.trans}"`;
            $('card-def').textContent = item.def;
            $('card-ex').textContent = item.ex;
        }

        function flipCard() {
            const card = $('game-card-inner').parentElement;
            card.classList.toggle('flipped');
        }

        function nextCard() {
            pickRandomCard();
        }


        // --- TAB SWITCHING ---
        function switchTab(tabId) {
            // Buttons
            document.querySelectorAll('.nav-link').forEach(el => el.classList.remove('active'));
            $(`tab-${tabId}`).classList.add('active');

            // Views
            if (tabId === 'lexique') {
                $('view-lexique').classList.remove('hidden');
                $('view-game').classList.add('hidden');
            } else {
                $('view-lexique').classList.add('hidden');
                $('view-game').classList.remove('hidden');
                pickRandomCard(); // Start game
            }
        }

        function scrollToTop() {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }


        // INITIALIZATION
        function init() {
            // Initialize References
            totalTermsEl = $('total-terms');
            // REMOVED: totalCountEl = $('total-count'); <--- Cause of the error
            container = $('lexicon-container');
            alphabetNav = $('alphabet-nav');
            searchInput = $('searchInput');
            noResults = $('noResults');
            backToTopBtn = $('backToTop');

            // --- SEARCH LOGIC ---
            searchInput.addEventListener('input', (e) => {
                const query = e.target.value.toLowerCase();
                const sections = container.children;
                let hasResults = false;

                Array.from(sections).forEach(section => {
                    const content = section.querySelector('.accordion-content');
                    const cards = content.querySelectorAll('.search-item');
                    let sectionHasMatch = false;

                    cards.forEach(card => {
                        const text = card.textContent.toLowerCase();
                        if (text.includes(query)) {
                            card.style.display = 'flex'; // Restore flex display
                            sectionHasMatch = true;
                            hasResults = true;
                        } else {
                            card.style.display = 'none';
                        }
                    });

                    // Open accordion if match found inside, or if query is cleared
                    if (query.length > 0 && sectionHasMatch) {
                        section.style.display = 'block';
                        if (!content.classList.contains('open')) {
                            content.classList.add('open'); // Force open
                        }
                    } else if (query.length > 0 && !sectionHasMatch) {
                        section.style.display = 'none';
                    } else {
                        // Reset: query empty
                        section.style.display = 'block';
                        cards.forEach(c => c.style.display = 'flex');
                        content.classList.remove('open'); // Collapse all on reset
                    }
                });

                if (!hasResults && query.length > 0) {
                    noResults.classList.remove('hidden');
                } else {
                    noResults.classList.add('hidden');
                }
            });

            // --- BACK TO TOP ---
            window.onscroll = function() {
                if (document.body.scrollTop > 300 || document.documentElement.scrollTop > 300) {
                    backToTopBtn.classList.remove('opacity-0', 'pointer-events-none');
                    backToTopBtn.classList.add('opacity-100', 'pointer-events-auto');
                } else {
                    backToTopBtn.classList.add('opacity-0', 'pointer-events-none');
                    backToTopBtn.classList.remove('opacity-100', 'pointer-events-auto');
                }
            };
            
            // Start App
            initLexicon();
        }

        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', init);
        } else {
            init();
        }
    </script>
</body>
</html>